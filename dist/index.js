(()=>{function _(){this.listener={mousedown:{},mousemove:{},mouseup:{},mouseenter:{},mouseleave:{},contextmenu:{},keydown:{},keyup:{},resize:{}}}_.prototype.addListener=function(i,e,n){if(!e||!i||!n)throw Error("Invalid arguments.",{event:e,id:i,cb:n});if(!this.listener[e])throw Error("Unknown event.",e);this.listener[e][i]=n,window.addEventListener(e,n)};_.prototype.removeListener=function(i,e){if(!e||!i)throw Error("Invalid arguments.",{event:e,id:i});if(!this.listener[e])throw Error("Unknown event.",e);if(!this.listener[e][i])throw Error(`No ${e} listener with this id: ${i}`);window.removeEventListener(e,this.listener[e][i]),delete this.listener[e][i]};var E=new _;var fe=document.body;function Z(i){let e=this;this.$contextMenu=void 0,this.$contextMenus=[],this.getContextMenu=()=>{},this.showContextMenu=function(n,o,a){let t=document.createElement("div");t.style.border="1px solid",t.style.padding="8px",t.style.position="absolute",t.style.zIndex=9,t.style.left=n+"px",t.style.top=o+"px";try{t.style.backgroundColor=i.getTheme().style.body.backgroundColor}catch(r){console.error(r)}t.onclick=()=>this.destroyContextMenu(),t.oncontextmenu=r=>{r.preventDefault(),r.stopPropagation()},a?a.forEach(r=>{r.style.display="block",t.appendChild(r)}):this.$contextMenus.forEach(r=>{t.appendChild(r)}),this.$contextMenu=t,fe.appendChild(this.$contextMenu)},this.moveContextMenu=function(n,o){this.$contextMenu.style.left=n+"px",this.$contextMenu.style.top=o+"px"},this.destroyContextMenu=function(){this.$contextMenu&&(this.$contextMenu.remove(),this.$contextMenu=void 0)},this.addToContextMenu=function(n){n.style.display="block",this.$contextMenus.push(n)},this.initEventListeners=function(){E.addListener("UI","contextmenu",n=>{if(n.preventDefault(),this.getContextMenu(n.target),this.$contextMenu){this.moveContextMenu(n.clientX,n.clientY);return}this.showContextMenu(n.clientX,n.clientY)}),E.addListener("UI","mousedown",n=>{!this.$contextMenu||n.target===this.$contextMenu||this.$contextMenu.contains(n.target)||this.destroyContextMenu()})}}function q(){let i={};this.setListener=e=>{i[e]={}},this.addListener=function(e,n,o){i[e][n]=o},this.removeListener=function(e){delete i[e]},this.init=()=>{E.addListener("UI","mousemove",e=>{for(let[,n]of Object.entries(i))n.mousemove&&n.mousemove(e)}),E.addListener("UI","mouseup",e=>{for(let[,n]of Object.entries(i))n.mouseup&&n.mouseup(e)})}}function J(i){this.createIcon=function(e,n){i.setListener(e);let o=!1,a=!1,t={x:0,y:0},r={x:0,y:0},s=document.createElement("div");return s.appendChild(n),s.style.border="1px solid",s.style.position="absolute",s.style.left=0,s.style.top=0,s.style.cursor="grab",s.style.userSelect="none",s.onmousedown=d=>{o=!0,t.x=d.clientX,t.y=d.clientY,r.x=Math.abs(t.x-s.offsetLeft),r.y=Math.abs(t.y-s.offsetTop),s.style.cursor="grabbing"},i.addListener(e,"mousemove",d=>{o&&(a=!0,s.style.left=d.clientX-r.x+"px",s.style.top=d.clientY-r.y+"px")}),i.addListener(e,"mouseup",()=>{o=!1,a=!1,s.style.cursor="grab"}),s}}var me={name:"dark",backgroundColor:"#222222",borderWidth:1,borderStyle:"solid",style:{body:{backgroundColor:"#222222",color:"#ffffff",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif"},button:{cursor:"pointer"}}},ge={name:"light",backgroundColor:"#ffffff",borderWidth:1,borderStyle:"solid",style:{body:{backgroundColor:"#ffffff",color:"#222222",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif"},button:{cursor:"pointer"}}},X={dark:me,light:ge};var K=document.head,ye=document.body;function Q(i){let e=null;this.themeListeners=[];function n(o){let a=document.createElement("style");for(let[t,r]of Object.entries(o.style))if(t==="body")for(let[s,d]of Object.entries(r))ye.style[s]=d;else if(t==="button"){let s="";for(let[d,l]of Object.entries(r))s+=`${we(d)}: ${l}; `;a.innerHTML+=`button { ${s} }`}return a}this.getTheme=()=>e,this.setTheme=function(o,a){if(!o)throw Error("Unknown newTheme",o);if(typeof o=="string"&&X[o]){this.setTheme(X[o]);return}e!==null&&K.removeChild(e.$style);let t=n(o);e={...o,$style:t},K.appendChild(t),this.notify(e),a&&a(e)},this.addListener=o=>{this.themeListeners.push(o)},this.notify=o=>{this.themeListeners.forEach(a=>a(o))}}function we(i){return i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function be(i){let e={name:"",onmousedown:()=>{},onclose:()=>{},...i};this.$element=document.createElement("div"),e.draggable?this.$element.style.cursor="grab":this.$element.style.cursor="auto",this.$element.style.borderBottom=`${e.style.borderWidth}px ${e.style.borderStyle}`,this.$element.style.padding=e.style.padding+"px";let n=document.createElement("button");return n.style.marginRight=e.style.padding+"px",n.innerHTML="&#x2715",this.$element.appendChild(n),this.$element.innerHTML+=e.name,this.$element.onmousedown=o=>{e.onmousedown(),e.draggable&&(this.$element.style.cursor="grabbing")},this.$element.onmouseup=o=>{if(o.target.innerText==="\u2715"){e.onclose();return}e.draggable&&(this.$element.style.cursor="grab")},this}function xe(i){return this.$element=document.createElement("div"),this.$element.style.padding=i.style.padding+"px",this.$element.style.overflow="auto",this.$element.style.cursor="auto",this.$element.style.boxSizing="border-box",this.$element.style.height="100%",this.reset=e=>{this.$element.innerHTML="",this.$element.appendChild(e)},this}function L(i,e){let n=this,o={id:Math.random().toString(36).slice(2,9),style:{padding:8,borderWidth:1,borderStyle:"solid"},...i};e.addListener(r=>{this.$background.style.backgroundColor=r.style.body.backgroundColor}),this.id=o.id,this.name=o.name||this.id,this.isHeaderMousedown=!1,this.minWidth=150,this.minHeight=150;let a=50;this.padding=o.style.padding,this.cursorThreshold=o.style.padding,this.eventListener={close:[]},this.$window=document.createElement("div"),this.$background=document.createElement("div"),this.$wrapper=document.createElement("div"),this.$wrapper.appendChild(this.$background),this.$window.appendChild(this.$wrapper),this.$background.style.backgroundColor=e.getTheme().style.body.backgroundColor,this.header=new be({...o,name:this.name,onmousedown:()=>this.isHeaderMousedown=!0,onclose:t}),this.$wrapper.appendChild(this.header.$element),this.body=new xe(o),this.$wrapper.appendChild(this.body.$element),this.$window.style.padding=o.style.padding+"px",this.$window.style.boxSizing="border-box",this.$window.style.userSelect="none",this.$window.style.minWidth=this.minWidth+"px",this.$window.style.minHeight=this.minHeight+"px",o.initialWidth?this.$window.style.width=o.initialWidth+a+"px":this.$window.style.width=this.minWidth+a+"px",this.$window.style.height=this.minHeight+a+"px",this.$background.style.position="absolute",this.$background.style.left=0,this.$background.style.top=0,this.$background.style.right=0,this.$background.style.bottom=0,this.$background.style.zIndex=-1,this.$background.style.opacity=.9,this.$wrapper.style.minWidth=this.minWidth-o.style.padding*2+"px",this.$wrapper.style.minHeight=this.minHeight-o.style.padding*2+"px",this.$wrapper.style.width=this.minWidth+a-o.style.padding*2+"px",this.$wrapper.style.height=this.minHeight+a-o.style.padding*2+"px",this.$wrapper.style.position="absolute",this.$wrapper.style.border=`${o.style.borderWidth}px ${o.style.borderStyle}`,this.$wrapper.style.overflow="hidden",this.$window.oncontextmenu=r=>{r.preventDefault(),r.stopPropagation()};function t(){n.$window.remove(),n.eventListener.close.forEach(r=>{r()})}return this}L.prototype.addEventListener=function(i,e){this.eventListener[i].push(e)};L.prototype.getClickedResizer=function(i,e){let n=e>this.$window.offsetTop&&e<this.$window.offsetTop+this.cursorThreshold,o=i<this.$window.offsetLeft+this.$window.offsetWidth&&i>this.$window.offsetLeft+this.$window.offsetWidth-this.cursorThreshold,a=e<this.$window.offsetTop+this.$window.offsetHeight&&e>this.$window.offsetTop+this.$window.offsetHeight-this.cursorThreshold,t=i>this.$window.offsetLeft&&i<this.$window.offsetLeft+this.cursorThreshold;return a&&o?"se":a&&t?"sw":n&&o?"ne":n&&t?"nw":n?"n":o?"e":a?"s":t?"w":""};L.prototype.setContent=function(i){this.body.reset(i)};L.prototype.finalize=function(){this.$wrapper.style.width=this.$window.offsetWidth-this.padding*2+"px",this.$wrapper.style.height=this.$window.offsetHeight-this.padding*2+"px",this.body.$element.style.maxHeight=this.$wrapper.offsetHeight-this.header.$element.offsetHeight+"px"};var $e=document.body;function ee(i,e){let n=this,o={};this.sendToTop=function(t){if(t){for(let[,r]of Object.entries(o)){let s=parseInt(r.$window.style.zIndex);s>1&&(r.$window.style.zIndex=s-1)}t.$window.style.zIndex=5}};function a(t,r={}){if(!t)throw Error("Unknown customWindow",t);let s=t.$window,d=t.$wrapper;s.style.position="absolute";let{resizeable:l,draggable:c,style:u={padding:16}}=r,p={x:0,y:0},g={x:0,y:0},f={w:0,h:0},k=!1,w=!1,T=!1,x="",I=h=>{k=!0,n.sendToTop(t),p.x=h.clientX,p.y=h.clientY,f.w=s.offsetWidth,f.h=s.offsetHeight,g.x=Math.abs(p.x-s.offsetLeft),g.y=Math.abs(p.y-s.offsetTop),x=t.getClickedResizer(h.clientX,h.clientY)},A=h=>{if(w||T)return;let $=h.clientY>s.offsetTop&&h.clientY<s.offsetTop+t.cursorThreshold,F=h.clientX<s.offsetLeft+s.offsetWidth&&h.clientX>s.offsetLeft+s.offsetWidth-t.cursorThreshold,U=h.clientY<s.offsetTop+s.offsetHeight&&h.clientY>s.offsetTop+s.offsetHeight-t.cursorThreshold,Y=h.clientX>s.offsetLeft&&h.clientX<s.offsetLeft+t.cursorThreshold;if($&&Y||U&&F){s.style.cursor="nwse-resize";return}else if($&&F||U&&Y){s.style.cursor="nesw-resize";return}else if(F||Y){s.style.cursor="col-resize";return}else if($||U){s.style.cursor="row-resize";return}s.style.cursor="auto"},S=h=>{if(k)if(t.isHeaderMousedown){if(!c)return;s.style.left=h.clientX-g.x+"px",s.style.top=h.clientY-g.y+"px"}else{if(!l)return;x.includes("e")?(s.style.width=f.w-(p.x-h.clientX)+"px",d.style.width=f.w-(p.x-h.clientX)-t.padding*2+"px"):x.includes("w")&&h.clientX-g.x<p.x+f.w-u.padding*2-t.cursorThreshold&&f.w+(p.x-h.clientX)-t.minWidth>0&&(s.style.left=h.clientX-g.x+"px",s.style.width=f.w+(p.x-h.clientX)+"px",d.style.width=f.w+(p.x-h.clientX)-t.padding*2+"px"),x.includes("s")?(s.style.height=f.h-(p.y-h.clientY)+"px",d.style.height=f.h-(p.y-h.clientY)-t.padding*2+"px"):x.includes("n")&&h.clientY-g.y<p.y+f.h-u.padding*2-t.cursorThreshold&&f.h+(p.y-h.clientY)-t.minHeight>0&&(s.style.top=h.clientY-g.y+"px",s.style.height=f.h+(p.y-h.clientY)+"px",d.style.height=f.h+(p.y-h.clientY)-t.padding*2+"px"),t.body.$element.style.maxHeight=d.offsetHeight-t.header.$element.offsetHeight+"px"}};s.onmousedown=I,l&&(s.onmousemove=A),i.addListener(t.id,"mousemove",S),i.addListener(t.id,"mouseup",()=>{k=!1,w=!1,T=!1,t.isHeaderMousedown=!1})}this.createWindow=function(t){let r={draggable:!1,resizeable:!1,theme:e.getTheme(),...t},s=new L(r,e);if(!o[s.name])return o[s.name]=s,i.setListener(s.id),(r.draggable||r.resizeable)&&a(s,r),s.addEventListener("close",function(){n.destroyWindow(s.name)}),$e.appendChild(s.$window),s.finalize(),s},this.destroyWindow=function(t){let r=o[t];i.removeListener(r.id),delete o[t]},this.closeAllWindow=function(){for(let[,t]of Object.entries(o))t.$window.remove(),this.destroyWindow(t.name)},this.isWindowOpened=function(t){return o[t]!==void 0},this.setWindowContent=function(t,r){let s=o[t];s&&s.setContent(r)},this.notify=t=>{for(let[,r]of Object.entries(o))r.setTheme(t)}}var P;function Ee(){let i=this,e=new q(i),n=new Q(i),o=new ee(e,n),a=new Z(n),t=new J(e);return this.themeListeners=[],this.setWindowContent=(...r)=>o.setWindowContent(...r),this.sendToTop=(...r)=>o.sendToTop(...r),this.createWindow=(...r)=>o.createWindow(...r),this.createIcon=(r,s)=>t.createIcon(r,s),this.getTheme=()=>n.getTheme(),this.showContextMenu=(...r)=>a.showContextMenu(...r),this.setTheme=r=>n.setTheme(r,s=>{o.notify(s)}),this.addThemeListener=r=>n.addListener(r),this.closeAllWindow=()=>o.closeAllWindow(),this.init=()=>{this.setTheme("dark"),e.init(),a.initEventListeners()},this}var y=()=>(P||(P=new Ee),P);var N;function C(){this.accessKey="software",this.software=new Map,this.listener={install:[]}}C.prototype.install=function(i){if(!i)throw Error("Undefined software.");if(!i.name)throw Error("Software name is required.");if(!i.start)throw Error("Software start function is required.");this.software.set(i.name,i),this.listener.install.forEach(e=>e())};C.prototype.getAllExcepts=function(i){let e=[];for(let[n,o]of this.software)i.includes(n)||e.push(o);return e};C.prototype.getAllExcept=function(i){let e=[];for(let[n,o]of this.software)n!==i&&e.push(o);return e};C.prototype.get=function(i){if(!i||!this.software.get(i))throw Error("Unknown software.");return this.software.get(i)};C.prototype.run=function(i,e){let n=this.software.get(i);if(!n)throw Error("unknown software:",i);n.start(e)};C.prototype.addEventListener=function(i,e){if(!this.listener[i])throw Error("Unknown event.",i);this.listener[i].push(e)};var W=()=>(N||(N=new C),N);var G;function Me(){let i=0,e=new Map;this.add=function(n,o){if(!n||!o)throw Error("Invalid arguments.");if(o.size&&(i+=o.size),!e.has(n))e.set(n,o);else{let a=e.get(n);a.data&&(a.size&&o.size&&(a.size+=o.size),a.data.set(o.id,o))}},this.get=function(n){if(!n)throw Error("Invalid path.",n);let o=new Map;e.forEach((t,r)=>{n==="/"?(r.match(/\//g)||[]).length===2&&o.set(r,t):r!==n&&r.startsWith(n)&&(r.replace(n,"").match(/\//g)||[]).length===1&&o.set(r,t)});let a=e.get(n);return a&&a.data&&a.data.forEach(t=>o.set(t.id,t)),o},this.deletePathData=(n,o)=>e.get(n).data.delete(o),this.getSize=function(){return i},this.set=function(n,o){e.set(n,o)},this.bulkModify=function(n,o){e.forEach((a,t)=>{t.startsWith(n)&&(a.path=o+t.substring(1),e.set(a.path,a),e.delete(t))})},this.deleteByPath=function(n){e.delete(n)},this.delete=function(n){if(n.type==="directory")e.delete(n.path);else{let o=e.get(n.path);o.size&&n.size&&(o.size-=n.size),o.data.delete(n.id)}},this.log=()=>{console.info(e)}}var te=()=>(G||(G=new Me),G);var B,M=te();function m(){let o=0,a=t();this.listener=new Map,this.directoryListener={};function t(){return Math.random().toString(36).slice(2,5)}function r(){return o>9007199254740991+-3&&(o=0,a=t()),++o+a}function s(l={}){let{type:c,name:u,path:p}=l,g=c.slice(0,1)+r();return{id:g,path:c==="directory"?p+g+"/":p,type:c,name:u||c,size:1}}this.createFile=function(l={}){let c=s({type:"file",...l});return this.listener.forEach((u,p)=>{u({event:m.CREATE_FILE,data:c})}),c},this.createDirectory=function(l={}){let c={...s({type:"directory",...l}),data:new Map};return this.listener.forEach((u,p)=>{u({event:m.CREATE_DIRECTORY,data:c})}),c},this.createRootDirectory=function(){return{...s({type:"directory"}),path:"/",name:"root",data:new Map,isSystemFile:!0}},this.createSystemDirectory=function(l){return{...s({type:"directory"}),path:"/"+l+"/",name:l,data:new Map,isSystemFile:!0}},this.getParentPath=l=>{let c=l.split("/");return c.pop(),c.length>1&&c.pop(),c.join("/")+"/"},this.isSystemFile=l=>l.isSystemFile,this.addListener=(l,c)=>{this.listener.set(l,c)},this.listenToDirectory=(l,c)=>{this.directoryListener[l.id]?this.directoryListener[l.id].push(c):this.directoryListener[l.id]=[]},this.rename=function(l,c){return l.name=c,l},this.read=function(l){console.info(l)},this.addToStorage=function(l={}){M.add(l.path,l),this.listener.forEach((c,u)=>{c({event:m.ADD_TO_STORAGE,data:l})})},this.move=function(l,c){c.type==="directory"&&(l.type==="file"?(c.data.set(l.id,l),M.deletePathData(l.path,l.id)):M.bulkModify(l.path,c.path),this.listener.forEach((u,p)=>{u({event:m.MOVE,data:{toBeMoved:l,target:c}})}))},this.set=function(l,c){M.set(l,c)},this.get=function(l){return M.get(l)},this.delete=function(l={}){this.listener.forEach((c,u)=>{c({event:m.DELETE,data:l})}),M.delete(l)};let d=this.createRootDirectory();M.add("/",d)}m.ADD_TO_STORAGE="addToStorage";m.CREATE_FILE="createFile";m.CREATE_DIRECTORY="createDirectory";m.DELETE="delete";m.MOVE="move";var v=()=>(B||(B=new m),B),Ve=m.MOVE,ne=m.DELETE,ie=m.CREATE_FILE,oe=m.CREATE_DIRECTORY,je=m.ADD_TO_STORAGE;var D=v(),H=y();function se(i){let e=this;this.name="Desktop",this.path="/desktop/",this.iconDomMap={};let n=document.createElement("div");n.id="$desktop",n.style.position="fixed",n.style.left=0,n.style.top=0,n.style.width="100vw",n.style.height="100vh",n.oncontextmenu=t=>{t.preventDefault();let r=document.createElement("button");r.innerHTML="Create file",r.onclick=()=>{let l=D.createFile({name:null,path:this.path});D.addToStorage(l)};let s=document.createElement("button");s.innerHTML="Close All Window",s.onclick=function(){H.closeAllWindow()};let d=[s,r];H.showContextMenu(t.clientX,t.clientY,d)};let o=D.createSystemDirectory("desktop");D.addToStorage(o),D.listenToDirectory(o,t=>{n.innerHTML="",t.forEach(r=>{a(r)})});function a(t){let r=document.createElement("div");r.innerHTML=JSON.stringify(t),r.style.background="#222",r.style.maxWidth="100px",r.style.maxHeight="100px",r.style.overflow="auto";let s=H.createIcon(t.id,r);t.type==="file"&&(s.ondblclick=()=>{i.run("File Reader",t)},s.oncontextmenu=d=>{d.preventDefault(),d.stopPropagation(),H.destroyContextMenu();let l=[],c=document.createElement("button");c.innerHTML="Open",c.onclick=()=>{i.run("File Reader",t)},l.push(c),H.showContextMenu(d.clientX,d.clientY,l)}),e.iconDomMap[t.id]=s,n.appendChild(s)}D.addListener("desktop.app",t=>{if(t&&!(!t.event||!t.data)){if(t.event===ie){if(t.data.path!==this.path)return;a(t.data)}else if(t.event===oe){if(!t.data.path||t.data.path.startsWith(this.path)===!1||(t.data.path.match(/\//g)||[]).length!==3)return;a(t.data)}else if(t.event===ne){if(!t.data.path)return;(t.data.path===this.path||t.data.path.startsWith(this.path)&&(t.data.path.match(/\//g)||[]).length===3)&&this.iconDomMap[t.data.id].remove()}}}),this.start=()=>{document.body.appendChild(n)}}function re(i){let e=document.createElement("div");e.style.boxSizing="border-box",e.style.position="fixed",e.style.zIndex=9,e.style.left=0,e.style.bottom=0,e.style.width="100%",e.style.padding="8px",e.style.boxSizing="border-box",e.style.borderTop=`${i.borderWidth}px ${i.borderStyle}`,e.style.backgroundColor=i.backgroundColor;let n=document.createElement("table"),o=document.createElement("td");o.setAttribute("width","100%");let a=document.createElement("button");a.innerHTML="Menu",o.appendChild(a),n.appendChild(o);let t=document.createElement("td"),r=document.createElement("span"),s=new Date;r.innerHTML=`${s.getHours()}:${s.getMinutes()}`,t.appendChild(r),n.appendChild(t),e.appendChild(n);let d=document.createElement("div");d.style.display="none",d.style.position="absolute",d.style.left=0,d.style.width="200px",d.style.height="200px",d.style.padding="8px",d.style.borderRight=`${i.borderWidth}px ${i.borderStyle}`,d.style.borderTop=`${i.borderWidth}px ${i.borderStyle}`,d.style.backgroundColor=i.backgroundColor,e.appendChild(d),setTimeout(()=>{d.style.bottom=e.offsetHeight+"px"},200),this.setTheme=function(l){e.style.backgroundColor=l.style.body.backgroundColor,d.style.backgroundColor=l.style.body.backgroundColor},this.addToMenu=l=>{l.style.display="block",d.appendChild(l)},this.clear=()=>d.innerHTML="",this.closeMenu=()=>d.style.display="none",a.onclick=()=>{d.style.display==="none"?d.style.display="block":d.style.display==="block"&&(d.style.display="none")},this.getMenuElement=()=>d,this.getMenuTrigger=()=>a,this.render=()=>document.body.appendChild(e),this.destroy=()=>e.remove()}var ae=y();function le(){let i=this;this.name="Dock";let e=W();e.addEventListener("install",()=>{this.refresh()}),this.ui=new re(ae.getTheme()),ae.addThemeListener(n=>i.ui.setTheme(n)),E.addListener("Dock","mousedown",n=>{n.target!==i.ui.getMenuElement()&&n.target!==i.ui.getMenuTrigger()&&!(n.target instanceof HTMLButtonElement)&&i.ui.closeMenu()}),this.refresh=()=>{i.ui.clear(),e.getAllExcepts(["Dock","Desktop"]).forEach(function(n){let o=document.createElement("button");o.innerHTML=n.name,o.onclick=()=>n.start(),i.ui.addToMenu(o)})},this.start=()=>{this.ui.render(),this.refresh()},this.stop=()=>{this.ui.destroy()}}var b=v(),V=y();function ce(i){let e=this;this.name="File Manager",this.currentPath="/",this.getHead=()=>{let a=document.createElement("div");a.style.marginBottom="8px";let t=document.createElement("button");t.innerHTML="create file",t.onclick=()=>{let l=b.createFile({name:null,path:this.currentPath});b.addToStorage(l),this.reload()},a.appendChild(t);let r=document.createElement("button");r.innerHTML="create directory",r.onclick=()=>{let l=b.createDirectory({name:null,path:this.currentPath});b.addToStorage(l),this.reload()},a.appendChild(r);let s=document.createElement("button");s.innerHTML="back",s.onclick=()=>{this.currentPath=b.getParentPath(this.currentPath),this.reload()};let d=document.createElement("p");return d.innerHTML=this.currentPath,a.appendChild(s),a.appendChild(d),a},this.getBody=()=>{let a=document.createElement("div"),t=this.generateTable();return a.appendChild(t),a},this.getRoot=()=>{let a=document.createElement("div"),t=this.getHead(),r=this.getBody();return a.appendChild(t),a.appendChild(r),a},this.reload=()=>{let a=this.getRoot();V.setWindowContent(this.name,a)},this.openDirectory=a=>{this.currentPath=a.path,this.reload()};function n(){let a=document.createElement("td");return a.style.border="1px solid",a.style.padding="4px",a}function o(a){let t=document.createElement("th");return t.style.border="1px solid",t.style.padding="4px",t.innerHTML=a,t}this.generateTable=()=>{let a=b.get(this.currentPath),t=document.createElement("table");t.style.borderCollapse="collapse",t.style.width="100%";let r=document.createElement("thead"),s=document.createElement("tr");s.appendChild(o("ID")),s.appendChild(o("Name")),s.appendChild(o("Type")),s.appendChild(o("Size")),r.appendChild(s),t.appendChild(r);let d=document.createElement("tbody");t.appendChild(d);let l;return a.forEach(c=>{let u=document.createElement("tr");c.isSystemFile||(u.draggable=!0,u.ondragstart=()=>l=c),u.ondragenter=w=>{u.style.backgroundColor="yellow"},u.ondragleave=w=>{u.style.backgroundColor="initial"},u.ondragover=w=>w.preventDefault(),u.ondrop=()=>{u.style.backgroundColor="initial",l.path.includes(c.path)||(b.move(l,c),this.reload())},u.onmousedown=function(w){w.button===2?(u.style.backgroundColor="#666",setTimeout(()=>{u.style.backgroundColor="initial"},200)):u.style.backgroundColor="#666"},u.onmouseup=function(w){u.style.backgroundColor="initial"};let p=n(),g=n(),f=n(),k=n();u.oncontextmenu=function(w){w.preventDefault();let T=[],x=document.createElement("button");if(x.innerHTML="Open",x.onclick=()=>{c.type==="file"?i.run("File Reader",c):c.type==="directory"&&e.openDirectory(c)},T.push(x),!b.isSystemFile(c)){let I=document.createElement("button");I.innerHTML="Rename";let A=h=>{let $=b.rename(c,h.target.innerHTML);f.contentEditable=!1,b.set(c.id,$)};I.onclick=()=>{f.contentEditable=!0,f.focus(),setTimeout(()=>{let h=document.createRange();h.selectNodeContents(f);var $=window.getSelection();$.removeAllRanges(),$.addRange(h)},50),f.onkeydown=h=>{h.key==="Enter"&&h.target.blur()},f.onblur=h=>A(h)},T.push(I);let S=document.createElement("button");S.innerHTML="Delete",S.onclick=()=>{b.delete(c),e.reload()},T.push(S)}V.showContextMenu(w.clientX,w.clientY,T)},u.ondblclick=()=>{c.type==="file"?i.run("File Reader",c):c.type==="directory"&&e.openDirectory(c)},p.innerHTML=c.id,g.innerHTML=c.type,f.innerHTML=c.isSystemFile?"."+c.name:c.name,k.innerHTML=c.size,u.appendChild(p),u.appendChild(f),u.appendChild(g),u.appendChild(k),d.appendChild(u)}),t},b.addListener("file-manager.app",a=>{a&&(!a.event||!a.data||this.reload())}),this.start=()=>{V.createWindow({name:this.name,resizeable:!0,draggable:!0,initialWidth:300}),this.reload()}}var O=y();function de(){this.name="File Reader",this.file=void 0,this.getContent=function(){if(this.file){let i=document.createElement("div");return i.style.wordBreak="break-all",i.style.userSelect="text",i.oncontextmenu=e=>e.stopPropagation(),i.innerHTML=JSON.stringify(this.file),i}else{let i=document.createElement("button");return i.onclick=function(){O.createWindow({name:"file prompt",resizeable:!0,draggable:!0})},i.innerHTML="Open File",i}},this.start=i=>{i&&(this.file=i);let e=O.createWindow({name:this.name,resizeable:!0,draggable:!0});O.sendToTop(e);let n=this.getContent();O.setWindowContent(this.name,n)}}var z=y();function he(){this.name="Settings",this.getContent=function(){let i=document.createElement("div"),e=document.createElement("button");e.onclick=function(){z.setTheme("dark")},e.innerHTML="Change to Dark Theme",i.appendChild(e);let n=document.createElement("button");return n.onclick=function(){z.setTheme("light")},n.innerHTML="Change to Light Theme",i.appendChild(n),i},this.start=()=>{let i=z.createWindow({name:this.name,resizeable:!0,draggable:!0});z.sendToTop(i);let e=this.getContent();z.setWindowContent(this.name,e)}}var j=y();function ue(){this.name="Window Creator",this.start=()=>{j.createWindow({name:this.name,resizeable:!0,draggable:!0});let i=document.createElement("button");i.innerHTML="create window",i.onclick=()=>{j.createWindow({draggable:!0,resizeable:!0})},j.setWindowContent(this.name,i)}}var R;function ke(){let i=y(),e=W();this.boot=()=>{i.init(),e.install(new le),e.install(new he),e.install(new ce(R)),e.install(new ue),e.install(new de),e.install(new se(R)),e.get("Dock").start(),e.get("Desktop").start()},this.run=function(n,o){e.run(n,o)}}var pe=()=>(R||(R=new ke),R);var Le=pe();Le.boot();})();
