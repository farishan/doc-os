(()=>{function re(e){let t=document.createElement("div");return t.style.width="100%",t.style.height="100%",t.style.display="flex",t.style.position="fixed",t.style.alignItems="center",t.style.justifyContent="center",t.appendChild(e),t}function dt(e){let t=e.split(""),o=[],n="",s=!0;return t.forEach(i=>{s&&i===" "?(o.push(n),n=""):s&&i==='"'?s=!1:s===!1&&i==='"'?s=!0:n+=i}),o.push(n),n="",o}var Te=dt;function $e(){return this.debug=!1,this.functionMap={},this.register=function(e,t){this.functionMap[e]=t},this.execute=function(...e){e.length===2?this.executeByKey(e[0],e[1]):this.executeLineCommand(e[0])},this.executeByKey=function(e,t){if(this.debug&&console.log(`[${performance.now().toFixed(2)}] executing: ${e}`),!this.functionMap[e])throw Error("Unknown function: "+e);return this.functionMap[e](t)},this.executeLineCommand=function(e){let t=Te(e),o=t[0];if(!this.functionMap[o])throw Error("Invalid line command: "+o);this.executeByKey(o,t[1])},this.executeLater=function(e,t){let o=this;setTimeout(()=>{o.execute(e)},t)},this}var ae=new $e,Le=()=>(ae||(ae=new $e),ae);function ke(){let e={},t={};return this.on=(o,n)=>e[o]=n,this.off=o=>delete e[o],this.get=(o,n)=>(t[o]||this.set(o),n?t[o][n]:t[o]),this.set=o=>t[o]={},this.isset=o=>!!t[o],this.add=(o,n,s)=>{t[o]||this.set(o),t[o][n]=s},this.remove=(o,n)=>{t[o]||this.set(o),n?delete t[o][n]:delete t[o]},this.has=(o,n)=>!!(t[o]&&t[o][n]),this.dispatch=(o,n,s)=>{for(let i=0;i<Object.keys(t[o]).length;i++){let r=Object.keys(t[o])[i];t[o][r]({event:n,data:s})}},this}var le=new ke,D=()=>(le||(le=new ke),le);var g=D();function G(){g.set("resize"),g.set("keyup"),g.set("keydown"),g.set("mouseup"),g.set("mousedown"),g.set("mousemove"),g.set("mouseenter"),g.set("mouseleave"),g.set("contextmenu")}G.prototype.addListener=function(e,t,o){if(!t||!e||!o)throw Error("Invalid arguments.",{event:t,id:e,cb:o});if(!g.isset(t))throw Error("Unknown event.",t);g.add(t,e,o),window.addEventListener(t,o)};G.prototype.removeListener=function(e,t){if(!t||!e)throw Error("Invalid arguments.",{event:t,id:e});if(!g.isset(t))throw Error("Unknown event.",t);if(!g.has(t,e))throw Error(`No ${t} listener with this id: ${e}`);window.removeEventListener(t,g.get(t,e)),g.remove(t,e)};var ce=new G,T=()=>(ce||(ce=new G),ce);var ht="file",ut="folder",pt="app",Ie=T(),Se={mousemove:"mousemove",mouseup:"mouseup"};function He(){this.createIcon=function(e,t,o){let n=!1,s=!1,i={x:0,y:0},r={x:0,y:0},a=document.createElement("div"),c=document.createElement("span");return o===ht?c.innerHTML="&#128196;":o===ut?c.innerHTML="&#128193;":o===pt&&(c.innerHTML="&#9670;"),a.append(c),a.appendChild(t),a.style.top=0,a.style.left=0,a.style.cursor="grab",a.style.userSelect="none",a.style.border="1px solid",a.style.position="absolute",a.onmousedown=u=>{n=!0,i.x=u.clientX,i.y=u.clientY,r.x=Math.abs(i.x-a.offsetLeft),r.y=Math.abs(i.y-a.offsetTop),a.style.cursor="grabbing"},Ie.addListener(e,Se.mousemove,u=>{n&&(s=!0,a.style.left=u.clientX-r.x+"px",a.style.top=u.clientY-r.y+"px")}),Ie.addListener(e,Se.mouseup,()=>{n=!1,s=!1,a.style.cursor="grab"}),a}}function De({minWidth:e,minHeight:t,options:o,extraSize:n}){let s=document.createElement("div");return s.style.padding=o.style.padding+"px",s.style.boxSizing="border-box",s.style.userSelect="none",s.style.minWidth=e+"px",s.style.minHeight=t+"px",s.style.width=o.initialWidth?o.initialWidth+n+"px":e+n+"px",s.style.height=t+n+"px",s.oncontextmenu=i=>{i.preventDefault(),i.stopPropagation()},s}function de(){return Math.random().toString(36).slice(2,5)}var ft=9007199254740991,mt=-3,he=0,We=de();function V(){return he>ft+mt&&(he=0,We=de()),++he+We}function ve(e){return this.$element=document.createElement("div"),this.$element.style.padding=e.style.padding+"px",this.$element.style.overflow="auto",this.$element.style.cursor="auto",this.$element.style.boxSizing="border-box",this.$element.style.height="100%",this.reset=t=>{t&&(this.$element.innerHTML="",this.$element.appendChild(t))},this}function Ae({minWidth:e,minHeight:t,options:o,extraSize:n}){let s=document.createElement("div");return s.style.minWidth=this.minWidth-o.style.padding*2+"px",s.style.minHeight=this.minHeight-o.style.padding*2+"px",s.style.width=this.minWidth+n-o.style.padding*2+"px",s.style.height=this.minHeight+n-o.style.padding*2+"px",s.style.position="absolute",s.style.border=`${o.style.borderWidth}px ${o.style.borderStyle}`,s.style.overflow="hidden",s}function Oe(e){let t={name:"",onmousedown:()=>{},onclose:()=>{},...e};this.$element=document.createElement("div"),t.draggable?this.$element.style.cursor="grab":this.$element.style.cursor="auto",this.$element.style.borderBottom=`${t.style.borderWidth}px ${t.style.borderStyle}`,this.$element.style.padding=t.style.padding+"px";let o=document.createElement("button");return o.style.marginRight=t.style.padding+"px",o.innerHTML="&#x2715",this.$element.appendChild(o),this.$element.innerHTML+=t.name,this.$element.onmousedown=n=>{t.onmousedown(),t.draggable&&(this.$element.style.cursor="grabbing")},this.$element.onmouseup=n=>{if(n.target.innerText==="\u2715"){t.onclose();return}t.draggable&&(this.$element.style.cursor="grab")},this}function Fe(){let e=document.createElement("div");return e.style.position="absolute",e.style.left=0,e.style.top=0,e.style.right=0,e.style.bottom=0,e.style.zIndex=-1,e.style.opacity=.9,e}function ze(e,t,o,n){let s=n>e.offsetTop&&n<e.offsetTop+t,i=o<e.offsetLeft+e.offsetWidth&&o>e.offsetLeft+e.offsetWidth-t,r=n<e.offsetTop+e.offsetHeight&&n>e.offsetTop+e.offsetHeight-t,a=o>e.offsetLeft&&o<e.offsetLeft+t;return r&&i?"se":r&&a?"sw":s&&i?"ne":s&&a?"nw":s?"n":i?"e":r?"s":a?"w":""}function W(e,t){let o=this,n={id:V(),style:{padding:8,borderWidth:1,borderStyle:"solid"},...e};t.addListener(r=>{this.$background.style.backgroundColor=r.style.body.backgroundColor}),this.id=n.id,this.name=n.name||this.id,this.isHeaderMousedown=!1,this.minWidth=150,this.minHeight=150;let s=50;this.padding=n.style.padding,this.cursorThreshold=n.style.padding,this.eventListener={close:[]},this.$window=De({minWidth:this.minWidth,minHeight:this.minHeight,options:n,extraSize:s}),this.$background=Fe(),this.$wrapper=Ae({minWidth:this.minWidth,minHeight:this.minHeight,options:n,extraSize:s}),this.$wrapper.appendChild(this.$background),this.$window.appendChild(this.$wrapper),this.$background.style.backgroundColor=t.getTheme().style.body.backgroundColor,this.header=new Oe({...n,name:this.name,onmousedown:()=>this.isHeaderMousedown=!0,onclose:i}),this.$wrapper.appendChild(this.header.$element),this.body=new ve(n),this.$wrapper.appendChild(this.body.$element);function i(){o.$window.remove(),o.eventListener.close.forEach(r=>{r()})}return this}W.prototype.addEventListener=function(e,t){this.eventListener[e].push(t)};W.prototype.getClickedResizer=function(e,t){return ze(this.$window,this.cursorThreshold,e,t)};W.prototype.setContent=function(e){this.body.reset(e)};W.prototype.finalize=function(){this.$wrapper.style.width=this.$window.offsetWidth-this.padding*2+"px",this.$wrapper.style.height=this.$window.offsetHeight-this.padding*2+"px",this.body.$element.style.maxHeight=this.$wrapper.offsetHeight-this.header.$element.offsetHeight+"px"};var gt={name:"dark",backgroundColor:"#222222",borderWidth:1,borderStyle:"solid",style:{body:{backgroundColor:"#222222",color:"#ffffff",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif"},button:{cursor:"pointer"}}},yt={name:"light",backgroundColor:"#ffffff",borderWidth:1,borderStyle:"solid",style:{body:{backgroundColor:"#ffffff",color:"#222222",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif"},button:{cursor:"pointer"}}},ue={dark:gt,light:yt};var Re=document.head,wt=document.body;function Pe(){let e=null;this.themeListeners=[];function t(o){let n=document.createElement("style");for(let[s,i]of Object.entries(o.style))if(s==="body")for(let[r,a]of Object.entries(i))wt.style[r]=a;else if(s==="button"){let r="";for(let[a,c]of Object.entries(i))r+=`${bt(a)}: ${c}; `;n.innerHTML+=`button { ${r} }`}return n}this.getTheme=()=>e,this.setTheme=function(o,n){if(!o)throw Error("Unknown newTheme",o);if(typeof o=="string"&&ue[o]){this.setTheme(ue[o]);return}e!==null&&Re.removeChild(e.$style);let s=t(o);e={...o,$style:s},Re.appendChild(s),this.notify(e),n&&n(e)},this.addListener=o=>{this.themeListeners.push(o)},this.notify=o=>{this.themeListeners.forEach(n=>n(o))},this.setTheme("dark")}function bt(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var pe=new Pe,v=()=>(pe||(pe=new Pe),pe);var fe=T(),Ye=v(),xt=document.body,Z={mousemove:"mousemove",mouseup:"mouseup"};function _e(){let e=this,t={};this.sendToTop=function(n){if(n){for(let[,s]of Object.entries(t)){let i=parseInt(s.$window.style.zIndex);i>1&&(s.$window.style.zIndex=i-1)}n.$window.style.zIndex=5}};function o(n,s={}){if(!n)throw Error("Unknown customWindow",n);let i=n.$window,r=n.$wrapper;i.style.position="absolute";let{resizeable:a,draggable:c,style:u={padding:16}}=s,l={x:0,y:0},h={x:0,y:0},p={w:0,h:0},S=!1,x=!1,R=!1,f="",H=d=>{S=!0,e.sendToTop(n),l.x=d.clientX,l.y=d.clientY,p.w=i.offsetWidth,p.h=i.offsetHeight,h.x=Math.abs(l.x-i.offsetLeft),h.y=Math.abs(l.y-i.offsetTop),f=n.getClickedResizer(d.clientX,d.clientY)},P=d=>{if(x||R)return;let L=d.clientY>i.offsetTop&&d.clientY<i.offsetTop+n.cursorThreshold,y=d.clientX<i.offsetLeft+i.offsetWidth&&d.clientX>i.offsetLeft+i.offsetWidth-n.cursorThreshold,M=d.clientY<i.offsetTop+i.offsetHeight&&d.clientY>i.offsetTop+i.offsetHeight-n.cursorThreshold,se=d.clientX>i.offsetLeft&&d.clientX<i.offsetLeft+n.cursorThreshold;if(L&&se||M&&y){i.style.cursor="nwse-resize";return}else if(L&&y||M&&se){i.style.cursor="nesw-resize";return}else if(y||se){i.style.cursor="col-resize";return}else if(L||M){i.style.cursor="row-resize";return}i.style.cursor="auto"},Y=d=>{if(S)if(n.isHeaderMousedown){if(!c)return;i.style.left=d.clientX-h.x+"px",i.style.top=d.clientY-h.y+"px"}else{if(!a)return;f.includes("e")?(i.style.width=p.w-(l.x-d.clientX)+"px",r.style.width=p.w-(l.x-d.clientX)-n.padding*2+"px"):f.includes("w")&&d.clientX-h.x<l.x+p.w-u.padding*2-n.cursorThreshold&&p.w+(l.x-d.clientX)-n.minWidth>0&&(i.style.left=d.clientX-h.x+"px",i.style.width=p.w+(l.x-d.clientX)+"px",r.style.width=p.w+(l.x-d.clientX)-n.padding*2+"px"),f.includes("s")?(i.style.height=p.h-(l.y-d.clientY)+"px",r.style.height=p.h-(l.y-d.clientY)-n.padding*2+"px"):f.includes("n")&&d.clientY-h.y<l.y+p.h-u.padding*2-n.cursorThreshold&&p.h+(l.y-d.clientY)-n.minHeight>0&&(i.style.top=d.clientY-h.y+"px",i.style.height=p.h+(l.y-d.clientY)+"px",r.style.height=p.h+(l.y-d.clientY)-n.padding*2+"px"),n.body.$element.style.maxHeight=r.offsetHeight-n.header.$element.offsetHeight+"px"}};i.onmousedown=H,a&&(i.onmousemove=P),fe.addListener(`customWindow_${n.id}`,Z.mousemove,Y),fe.addListener(`customWindow_${n.id}`,Z.mouseup,()=>{S=!1,x=!1,R=!1,n.isHeaderMousedown=!1})}this.createWindow=function(n){let s={draggable:!1,resizeable:!1,theme:Ye.getTheme(),...n},i=new W(s,Ye);if(!t[i.name])return t[i.name]=i,(s.draggable||s.resizeable)&&o(i,s),i.addEventListener("close",function(){e.destroyWindow(i.name)}),xt.appendChild(i.$window),i.finalize(),i},this.destroyWindow=function(n){let s=t[n];for(let i=0;i<Object.keys(Z).length;i++){let r=Object.keys(Z)[i];fe.removeListener(`customWindow_${s.id}`,r)}delete t[n]},this.closeAllWindow=function(){for(let[,n]of Object.entries(t))n.$window.remove(),this.destroyWindow(n.name)},this.isWindowOpened=function(n){return t[n]!==void 0},this.setWindowContent=function(n,s){let i=t[n];i&&i.setContent(s)},this.notify=n=>{for(let[,s]of Object.entries(t))s.setTheme(n)}}var Ue=T(),Et=v(),Ct=document.body;function Xe(){this.$contextMenu=void 0,this.$contextMenus=[],this.getContextMenu=()=>{},this.showContextMenu=function(e,t,o){let n=document.createElement("div");n.style.border="1px solid",n.style.padding="8px",n.style.position="absolute",n.style.zIndex=9,n.style.left=e+"px",n.style.top=t+"px";try{n.style.backgroundColor=Et.getTheme().style.body.backgroundColor}catch(s){console.error(s)}n.onclick=()=>this.destroyContextMenu(),n.oncontextmenu=s=>{s.preventDefault(),s.stopPropagation()},o?o.forEach(s=>{s.style.display="block",n.appendChild(s)}):this.$contextMenus.forEach(s=>{n.appendChild(s)}),this.$contextMenu=n,Ct.appendChild(this.$contextMenu)},this.moveContextMenu=function(e,t){this.$contextMenu.style.left=e+"px",this.$contextMenu.style.top=t+"px"},this.destroyContextMenu=function(){this.$contextMenu&&(this.$contextMenu.remove(),this.$contextMenu=void 0)},this.addToContextMenu=function(e){e.style.display="block",this.$contextMenus.push(e)},this.init=function(){Ue.addListener("UI","contextmenu",e=>{if(e.preventDefault(),this.getContextMenu(e.target),this.$contextMenu){this.moveContextMenu(e.clientX,e.clientY);return}this.showContextMenu(e.clientX,e.clientY)}),Ue.addListener("UI","mousedown",e=>{!this.$contextMenu||e.target===this.$contextMenu||this.$contextMenu.contains(e.target)||this.destroyContextMenu()})}}var Ne=new He,_=v(),C=new _e,ge=new Xe;function E(){return this.init=()=>{this.setTheme("dark"),ge.init()},this}E.prototype.getTheme=_.getTheme.bind(_);E.prototype.createIcon=Ne.createIcon.bind(Ne);E.prototype.sendToTop=C.sendToTop.bind(C);E.prototype.createWindow=C.createWindow.bind(C);E.prototype.addThemeListener=_.addListener.bind(_);E.prototype.closeAllWindow=C.closeAllWindow.bind(C);E.prototype.setWindowContent=C.setWindowContent.bind(C);E.prototype.showContextMenu=ge.showContextMenu.bind(ge);E.prototype.setTheme=e=>_.setTheme(e,t=>{C.notify(t)});var me=new E,m=()=>(me||(me=new E),me);var ye=m(),Be=Le();function je(){this.name="Terminal";let e=[],t=document.createElement("div");Be.register("echo",n=>{e.push(n),o()});function o(){t.innerHTML="";for(let n=e.length-1;n>=0;n--){let s=e[n];t.innerHTML+=`${s}<br>`}}this.getContent=function(){let n=document.createElement("div"),s=document.createElement("input");return s.placeholder='echo "hello world"',s.addEventListener("keydown",i=>{i.key==="Enter"&&(console.log(s.value),Be.execute(s.value),s.value="")}),n.append(s),n.append(t),n},this.start=()=>{let n=ye.createWindow({name:this.name,resizeable:!0,draggable:!0});ye.sendToTop(n);let s=this.getContent();ye.setWindowContent(this.name,s)}}var U=m();function Ke(){this.name="Settings",this.getContent=function(){let e=document.createElement("div"),t=document.createElement("button");t.onclick=function(){U.setTheme("dark")},t.innerHTML="Change to Dark Theme",e.appendChild(t);let o=document.createElement("button");return o.onclick=function(){U.setTheme("light")},o.innerHTML="Change to Light Theme",e.appendChild(o),e},this.start=()=>{let e=U.createWindow({name:this.name,resizeable:!0,draggable:!0});U.sendToTop(e);let t=this.getContent();U.setWindowContent(this.name,t)}}var we;function k(){this.accessKey="software",this.software=new Map,this.listener={install:[]}}k.prototype.install=function(e){if(!e)throw Error("Undefined software.");if(!e.name)throw Error("Software name is required.");if(!e.start)throw Error("Software start function is required.");this.software.set(e.name,e),this.listener.install.forEach(t=>t())};k.prototype.getAllExcepts=function(e){let t=[];for(let[o,n]of this.software)e.includes(o)||t.push(n);return t};k.prototype.getAllExcept=function(e){let t=[];for(let[o,n]of this.software)o!==e&&t.push(n);return t};k.prototype.get=function(e){if(!e||!this.software.get(e))throw Error("Unknown software.");return this.software.get(e)};k.prototype.run=function(e,t){let o=this.software.get(e);if(!o)throw Error("unknown software:",e);o.start(t)};k.prototype.addEventListener=function(e,t){if(!this.listener[e])throw Error("Unknown event.",e);this.listener[e].push(t)};var q=()=>(we||(we=new k),we);function Mt(){let e=new Map,t=0;this.add=function(o,n){if(!o||!n)throw Error("Invalid arguments.",{k:o,v:n});if(n.size&&(t+=n.size),!e.has(o))e.set(o,n);else{let s=e.get(o);if(!s.data)return;s.size&&n.size&&(s.size+=n.size),s.data.set(n.id,n)}},this.getDirectories=(o,n)=>{e.forEach((s,i)=>{o==="/"?(i.match(/\//g)||[]).length===2&&n.set(i,s):i!==o&&i.startsWith(o)&&(i.replace(o,"").match(/\//g)||[]).length===1&&n.set(i,s)})},this.getFiles=(o,n)=>{let s=e.get(o);s&&s.data&&s.data.forEach(i=>n.set(i.id,i))},this.get=o=>e.get(o),this.getWithPath=function(o){if(!o)throw Error("Invalid path.",o);let n=new Map;return this.getDirectories(o,n),this.getFiles(o,n),n},this.deletePathData=(o,n)=>e.get(o).data.delete(n),this.getSize=()=>t,this.set=(o,n)=>e.set(o,n),this.deleteByPath=o=>e.delete(o),this.bulkModify=function(o,n){e.forEach((s,i)=>{i.startsWith(o)&&(s.path=n+i.substring(1),e.set(s.path,s),e.delete(i))})},this.delete=function(o){if(o.type==="directory")e.delete(o.path);else{let n=e.get(o.path);n.size&&o.size&&(n.size-=o.size),n.data.delete(o.id)}},this.log=()=>console.info(e),this.write=this.set.bind(this),this.read=this.get.bind(this)}var w=new Mt;var I="CustomFileSystem";var Ge="addToStorage",J="createFile",X="createDirectory",Q="delete",Ve="move",Ze="file",qe="directory";function A(e={}){return this.size=1,this.type=e.type||"file",this.id=this.type.slice(0,1)+V(),this.name=e.name||this.type,this.path=this.type==="directory"?e.path+this.id+"/":e.path,this}var Je=D();function Qe(){return this.create=function(e={}){let t={...new A({type:"directory",...e}),data:new Map};return Je.dispatch(I,X,t),t},this.createSystemDirectory=function(e){return{...new A({type:"directory"}),path:"/"+e+"/",name:e,data:new Map,isSystemFile:!0}},this.addListener=(e,t,o)=>{Je.add(`${I}_dir`,`${e}_${t}`,o)},this}var be=new Qe,et=()=>(be||(be=new Qe),be);var Ee=D(),O=et();Ee.set(I);function ee(e,t){return Ee.dispatch(I,e,t),t}function $(){this.read=e=>console.info(e),this.isSystemFile=e=>e.isSystemFile,this.addListener=(e,t)=>Ee.add(I,e,t),this.createFile=function(e={}){return ee(J,new A({type:"file",...e}))},this.getParentPath=e=>{let t=e.split("/");return t.pop(),t.length>1&&t.pop(),t.join("/")+"/"},this.rename=function(e,t){return e.name=t,e},this.addToStorage=function(e={}){w.add(e.path,ee(Ge,e))},this.move=function(e,t){if(!(t.type!==qe||e===t))return e.type===Ze?(t.data.set(e.id,{...e,path:t.path}),w.deletePathData(e.path,e.id)):w.bulkModify(e.path,t.path),ee(Ve,{toBeMoved:e,target:t})},this.delete=function(e={}){w.delete(ee(Q,e))},w.add("/",{...new A({type:"directory"}),path:"/",name:"root",data:new Map,isSystemFile:!0})}$.prototype.get=w.get.bind(w);$.prototype.set=w.set.bind(w);$.prototype.getWithPath=w.getWithPath.bind(w);$.prototype.createDirectory=O.create.bind(O);$.prototype.createSystemDirectory=O.createSystemDirectory.bind(O);$.prototype.listenToDirectory=O.addListener.bind(O);var xe=new $,te=()=>(xe||(xe=new $),xe);var b=te(),Ce=m();function tt(e){let t=this;this.name="File Manager",this.currentPath="/",this.getHead=()=>{let s=document.createElement("div");s.style.marginBottom="8px";let i=document.createElement("button");i.innerHTML="create file",i.onclick=()=>{let u=b.createFile({name:null,path:this.currentPath});b.addToStorage(u),this.reload()},s.appendChild(i);let r=document.createElement("button");r.innerHTML="create directory",r.onclick=()=>{let u=b.createDirectory({name:null,path:this.currentPath});b.addToStorage(u),this.reload()},s.appendChild(r);let a=document.createElement("button");a.innerHTML="back",a.onclick=()=>{this.currentPath=b.getParentPath(this.currentPath),this.reload()};let c=document.createElement("p");return c.innerHTML=this.currentPath,s.appendChild(a),s.appendChild(c),s},this.getBody=()=>{let s=document.createElement("div"),i=this.generateTable();return s.appendChild(i),s},this.getRoot=()=>{let s=document.createElement("div"),i=this.getHead(),r=this.getBody();return s.appendChild(i),s.appendChild(r),s},this.reload=()=>{let s=this.getRoot();Ce.setWindowContent(this.name,s)},this.openDirectory=s=>{this.currentPath=s.path,this.reload()};function o(){let s=document.createElement("td");return s.style.border="1px solid",s.style.padding="4px",s}function n(s){let i=document.createElement("th");return i.style.border="1px solid",i.style.padding="4px",i.innerHTML=s,i}this.generateTable=()=>{let s=b.getWithPath(this.currentPath),i=document.createElement("table");i.style.borderCollapse="collapse",i.style.width="100%";let r=document.createElement("thead"),a=document.createElement("tr");a.appendChild(n("ID")),a.appendChild(n("Name")),a.appendChild(n("Type")),a.appendChild(n("Size")),r.appendChild(a),i.appendChild(r);let c=document.createElement("tbody");i.appendChild(c);let u;return s.forEach(l=>{let h=document.createElement("tr");l.isSystemFile||(h.draggable=!0,h.ondragstart=()=>u=l),h.ondragenter=f=>{h.style.backgroundColor="yellow"},h.ondragleave=f=>{h.style.backgroundColor="initial"},h.ondragover=f=>f.preventDefault(),h.ondrop=()=>{h.style.backgroundColor="initial",u.path.includes(l.path)||(b.move(u,l),this.reload())},h.onmousedown=function(f){f.button===2?(h.style.backgroundColor="#666",setTimeout(()=>{h.style.backgroundColor="initial"},200)):h.style.backgroundColor="#666"},h.onmouseup=function(f){h.style.backgroundColor="initial"};let p=o(),S=o(),x=o(),R=o();h.oncontextmenu=function(f){f.preventDefault();let H=[],P=document.createElement("button");if(P.innerHTML="Open",P.onclick=()=>{l.type==="file"?e.run("File Reader",l):l.type==="directory"&&t.openDirectory(l)},H.push(P),!b.isSystemFile(l)){let Y=document.createElement("button");Y.innerHTML="Rename";let d=y=>{let M=b.rename(l,y.target.innerHTML);x.contentEditable=!1,b.set(l.id,M)};Y.onclick=()=>{x.contentEditable=!0,x.focus(),setTimeout(()=>{let y=document.createRange();y.selectNodeContents(x);var M=window.getSelection();M.removeAllRanges(),M.addRange(y)},50),x.onkeydown=y=>{y.key==="Enter"&&y.target.blur()},x.onblur=y=>d(y)},H.push(Y);let L=document.createElement("button");L.innerHTML="Delete",L.onclick=()=>{b.delete(l),t.reload()},H.push(L)}Ce.showContextMenu(f.clientX,f.clientY,H)},h.ondblclick=()=>{l.type==="file"?e.run("File Reader",l):l.type==="directory"&&t.openDirectory(l)},p.innerHTML=l.id,S.innerHTML=l.type,x.innerHTML=l.isSystemFile?"."+l.name:l.name,R.innerHTML=l.size,h.appendChild(p),h.appendChild(x),h.appendChild(S),h.appendChild(R),c.appendChild(h)}),i},b.addListener("file-manager.app",s=>{s&&(!s.event||!s.data||this.reload())}),this.start=()=>{Ce.createWindow({name:this.name,resizeable:!0,draggable:!0,initialWidth:300}),this.reload()}}function nt(e){let t=document.createElement("div");t.style.boxSizing="border-box",t.style.position="fixed",t.style.zIndex=9,t.style.left=0,t.style.bottom=0,t.style.width="100%",t.style.padding="8px",t.style.boxSizing="border-box",t.style.borderTop=`${e.borderWidth}px ${e.borderStyle}`,t.style.backgroundColor=e.backgroundColor;let o=document.createElement("table"),n=document.createElement("td");n.setAttribute("width","100%");let s=document.createElement("button");s.innerHTML="Menu",n.appendChild(s),o.appendChild(n);let i=document.createElement("td"),r=document.createElement("span"),a=new Date;r.innerHTML=`${a.getHours()}:${a.getMinutes()}`,i.appendChild(r),o.appendChild(i),t.appendChild(o);let c=document.createElement("div");c.style.display="none",c.style.position="absolute",c.style.left=0,c.style.width="200px",c.style.height="200px",c.style.padding="8px",c.style.borderRight=`${e.borderWidth}px ${e.borderStyle}`,c.style.borderTop=`${e.borderWidth}px ${e.borderStyle}`,c.style.backgroundColor=e.backgroundColor,t.appendChild(c),setTimeout(()=>{c.style.bottom=t.offsetHeight+"px"},200),this.setTheme=function(u){t.style.backgroundColor=u.style.body.backgroundColor,c.style.backgroundColor=u.style.body.backgroundColor},this.addToMenu=u=>{u.style.display="block",c.appendChild(u)},this.clear=()=>c.innerHTML="",this.closeMenu=()=>c.style.display="none",s.onclick=()=>{c.style.display==="none"?c.style.display="block":c.style.display==="block"&&(c.style.display="none")},this.getMenuElement=()=>c,this.getMenuTrigger=()=>s,this.render=()=>document.body.appendChild(t),this.destroy=()=>t.remove()}var ot=m(),$t=T(),it=q(),N="Dock";function st(){let e=this;this.name=N,it.addEventListener("install",()=>{this.refresh()}),this.ui=new nt(ot.getTheme()),ot.addThemeListener(t=>e.ui.setTheme(t)),$t.addListener(N,"mousedown",t=>{t.target!==e.ui.getMenuElement()&&t.target!==e.ui.getMenuTrigger()&&!(t.target instanceof HTMLButtonElement)&&e.ui.closeMenu()}),this.refresh=()=>{e.ui.clear(),it.getAllExcepts([N,"Desktop"]).forEach(function(t){let o=document.createElement("button");o.innerHTML=t.name,o.onclick=()=>t.start(),e.ui.addToMenu(o)})},this.start=()=>{this.ui.render(),this.refresh()},this.stop=()=>{this.ui.destroy()}}var ne=m();function rt(){this.name="File Reader",this.file=void 0,this.getContent=function(){if(this.file){let e=document.createElement("div");return e.style.wordBreak="break-all",e.style.userSelect="text",e.oncontextmenu=t=>t.stopPropagation(),e.innerHTML=`<pre><code>${JSON.stringify(this.file," ",2)}</code></pre>`,e}else{let e=document.createElement("button");return e.onclick=function(){ne.createWindow({name:"file prompt",resizeable:!0,draggable:!0})},e.innerHTML="Open File",e}},this.start=e=>{e&&(this.file=e);let t=ne.createWindow({name:this.name,resizeable:!0,draggable:!0});ne.sendToTop(t);let o=this.getContent();ne.setWindowContent(this.name,o)}}var F=te(),B=m(),oe="Desktop";function at(e){let t=this;this.name=oe,this.path="/desktop/",this.iconDomMap={};let o=document.createElement("div");o.id="$desktop",o.style.position="fixed",o.style.left=0,o.style.top=0,o.style.width="100vw",o.style.height="100vh",o.oncontextmenu=i=>{i.preventDefault();let r=document.createElement("button");r.innerHTML="Create file",r.onclick=()=>{let u=F.createFile({name:null,path:this.path});F.addToStorage(u)};let a=document.createElement("button");a.innerHTML="Close All Window",a.onclick=function(){B.closeAllWindow()};let c=[a,r];B.showContextMenu(i.clientX,i.clientY,c)};let n=F.createSystemDirectory("desktop");F.addToStorage(n),F.listenToDirectory(oe,n,i=>{o.innerHTML="",i.forEach(r=>{s(r)})});function s(i){let r=document.createElement("div");r.innerHTML=JSON.stringify(i),r.style.background="#222",r.style.maxWidth="100px",r.style.maxHeight="100px",r.style.overflow="auto";let a=B.createIcon(i.id,r,i.type);i.type==="file"&&(a.ondblclick=()=>{e.run("File Reader",i)},a.oncontextmenu=c=>{c.preventDefault(),c.stopPropagation(),B.destroyContextMenu();let u=[],l=document.createElement("button");l.innerHTML="Open",l.onclick=()=>{e.run("File Reader",i)},u.push(l),B.showContextMenu(c.clientX,c.clientY,u)}),t.iconDomMap[i.id]=a,o.appendChild(a)}F.addListener("desktop.app",i=>{if(i&&!(!i.event||!i.data)){if(i.event===J){if(i.data.path!==this.path)return;s(i.data)}else if(i.event===X){if(!i.data.path||i.data.path.startsWith(this.path)===!1||(i.data.path.match(/\//g)||[]).length!==3)return;s(i.data)}else if(i.event===Q){if(!i.data.path)return;(i.data.path===this.path||i.data.path.startsWith(this.path)&&(i.data.path.match(/\//g)||[]).length===3)&&this.iconDomMap[i.data.id].remove()}}}),this.start=()=>{document.body.appendChild(o)}}var Me=m();function lt(){this.name="Window Creator",this.start=()=>{Me.createWindow({name:this.name,resizeable:!0,draggable:!0});let e=document.createElement("button");e.innerHTML="create window",e.onclick=()=>{Me.createWindow({draggable:!0,resizeable:!0})},Me.setWindowContent(this.name,e)}}var Lt=m(),z=q();function K(){this.boot=()=>{Lt.init(),this.install(new st),this.install(new Ke),this.install(new rt),this.install(new at(j)),this.install(new lt),this.install(new tt(j)),this.install(new je),this.run(N),this.run(oe)}}K.prototype.get=z.get.bind(z);K.prototype.install=z.install.bind(z);K.prototype.run=z.run.bind(z);var j=new K,ct=()=>(j||(j=new K),j);var kt=ct(),ie=document.createElement("button");ie.innerHTML="click me to boot the OS";ie.onclick=()=>{kt.boot(),ie.remove()};var It=re(ie);document.body.appendChild(It);})();
