(()=>{function de(n){let t=document.createElement("div");t.style.boxSizing="border-box",t.style.position="fixed",t.style.zIndex=9,t.style.left=0,t.style.bottom=0,t.style.width="100%",t.style.padding="8px",t.style.boxSizing="border-box",t.style.borderTop=`${n.borderWidth}px ${n.borderStyle}`,t.style.backgroundColor=n.backgroundColor;let i=document.createElement("table"),e=document.createElement("td");e.setAttribute("width","100%");let s=document.createElement("button");s.innerHTML="Menu",e.appendChild(s),i.appendChild(e);let o=document.createElement("td"),l=document.createElement("span"),c=new Date;l.innerHTML=`${c.getHours()}:${c.getMinutes()}`,o.appendChild(l),i.appendChild(o),t.appendChild(i);let d=document.createElement("div");d.style.display="none",d.style.position="absolute",d.style.left=0,d.style.width="200px",d.style.height="200px",d.style.padding="8px",d.style.borderRight=`${n.borderWidth}px ${n.borderStyle}`,d.style.borderTop=`${n.borderWidth}px ${n.borderStyle}`,d.style.backgroundColor=n.backgroundColor,t.appendChild(d),setTimeout(()=>{d.style.bottom=t.offsetHeight+"px"},200),this.setTheme=function(a){t.style.backgroundColor=a.style.body.backgroundColor,d.style.backgroundColor=a.style.body.backgroundColor},this.addToMenu=a=>{a.style.display="block",d.appendChild(a)},this.clear=()=>d.innerHTML="",this.closeMenu=()=>d.style.display="none",s.onclick=()=>{d.style.display==="none"?d.style.display="block":d.style.display==="block"&&(d.style.display="none")},this.getMenuElement=()=>d,this.getMenuTrigger=()=>s,this.render=()=>document.body.appendChild(t),this.destroy=()=>t.remove()}function he(){let n={},t={};return this.on=(i,e)=>n[i]=e,this.off=i=>delete n[i],this.get=(i,e)=>(t[i]||this.set(i),e?t[i][e]:t[i]),this.set=i=>t[i]={},this.isset=i=>!!t[i],this.add=(i,e,s)=>{t[i]||this.set(i),t[i][e]=s},this.remove=(i,e)=>{t[i]||this.set(i),e?delete t[i][e]:delete t[i]},this.has=(i,e)=>!!(t[i]&&t[i][e]),this}var j=new he,ue=()=>(j||(j=new he),j);var y=ue();function _(){y.set("resize"),y.set("keyup"),y.set("keydown"),y.set("mouseup"),y.set("mousedown"),y.set("mousemove"),y.set("mouseenter"),y.set("mouseleave"),y.set("contextmenu")}_.prototype.addListener=function(n,t,i){if(!t||!n||!i)throw Error("Invalid arguments.",{event:t,id:n,cb:i});if(!y.isset(t))throw Error("Unknown event.",t);y.add(t,n,i),window.addEventListener(t,i)};_.prototype.removeListener=function(n,t){if(!t||!n)throw Error("Invalid arguments.",{event:t,id:n});if(!y.isset(t))throw Error("Unknown event.",t);if(!y.has(t,n))throw Error(`No ${t} listener with this id: ${n}`);window.removeEventListener(t,y.get(t,n)),y.remove(t,n)};var Z=new _,C=()=>(Z||(Z=new _),Z);var q;function k(){this.accessKey="software",this.software=new Map,this.listener={install:[]}}k.prototype.install=function(n){if(!n)throw Error("Undefined software.");if(!n.name)throw Error("Software name is required.");if(!n.start)throw Error("Software start function is required.");this.software.set(n.name,n),this.listener.install.forEach(t=>t())};k.prototype.getAllExcepts=function(n){let t=[];for(let[i,e]of this.software)n.includes(i)||t.push(e);return t};k.prototype.getAllExcept=function(n){let t=[];for(let[i,e]of this.software)i!==n&&t.push(e);return t};k.prototype.get=function(n){if(!n||!this.software.get(n))throw Error("Unknown software.");return this.software.get(n)};k.prototype.run=function(n,t){let i=this.software.get(n);if(!i)throw Error("unknown software:",n);i.start(t)};k.prototype.addEventListener=function(n,t){if(!this.listener[n])throw Error("Unknown event.",n);this.listener[n].push(t)};var U=()=>(q||(q=new k),q);var _e="file",Ue="folder",Xe="app",pe=C(),fe={mousemove:"mousemove",mouseup:"mouseup"};function me(){this.createIcon=function(n,t,i){let e=!1,s=!1,o={x:0,y:0},l={x:0,y:0},c=document.createElement("div"),d=document.createElement("span");return i===_e?d.innerHTML="&#128196;":i===Ue?d.innerHTML="&#128193;":i===Xe&&(d.innerHTML="&#9670;"),c.append(d),c.appendChild(t),c.style.top=0,c.style.left=0,c.style.cursor="grab",c.style.userSelect="none",c.style.border="1px solid",c.style.position="absolute",c.onmousedown=a=>{e=!0,o.x=a.clientX,o.y=a.clientY,l.x=Math.abs(o.x-c.offsetLeft),l.y=Math.abs(o.y-c.offsetTop),c.style.cursor="grabbing"},pe.addListener(n,fe.mousemove,a=>{e&&(s=!0,c.style.left=a.clientX-l.x+"px",c.style.top=a.clientY-l.y+"px")}),pe.addListener(n,fe.mouseup,()=>{e=!1,s=!1,c.style.cursor="grab"}),c}}function Ne(n){let t={name:"",onmousedown:()=>{},onclose:()=>{},...n};this.$element=document.createElement("div"),t.draggable?this.$element.style.cursor="grab":this.$element.style.cursor="auto",this.$element.style.borderBottom=`${t.style.borderWidth}px ${t.style.borderStyle}`,this.$element.style.padding=t.style.padding+"px";let i=document.createElement("button");return i.style.marginRight=t.style.padding+"px",i.innerHTML="&#x2715",this.$element.appendChild(i),this.$element.innerHTML+=t.name,this.$element.onmousedown=e=>{t.onmousedown(),t.draggable&&(this.$element.style.cursor="grabbing")},this.$element.onmouseup=e=>{if(e.target.innerText==="\u2715"){t.onclose();return}t.draggable&&(this.$element.style.cursor="grab")},this}function Be(n){return this.$element=document.createElement("div"),this.$element.style.padding=n.style.padding+"px",this.$element.style.overflow="auto",this.$element.style.cursor="auto",this.$element.style.boxSizing="border-box",this.$element.style.height="100%",this.reset=t=>{t&&(this.$element.innerHTML="",this.$element.appendChild(t))},this}function D(n,t){let i=this,e={id:Math.random().toString(36).slice(2,9),style:{padding:8,borderWidth:1,borderStyle:"solid"},...n};t.addListener(l=>{this.$background.style.backgroundColor=l.style.body.backgroundColor}),this.id=e.id,this.name=e.name||this.id,this.isHeaderMousedown=!1,this.minWidth=150,this.minHeight=150;let s=50;this.padding=e.style.padding,this.cursorThreshold=e.style.padding,this.eventListener={close:[]},this.$window=document.createElement("div"),this.$background=document.createElement("div"),this.$wrapper=document.createElement("div"),this.$wrapper.appendChild(this.$background),this.$window.appendChild(this.$wrapper),this.$background.style.backgroundColor=t.getTheme().style.body.backgroundColor,this.header=new Ne({...e,name:this.name,onmousedown:()=>this.isHeaderMousedown=!0,onclose:o}),this.$wrapper.appendChild(this.header.$element),this.body=new Be(e),this.$wrapper.appendChild(this.body.$element),this.$window.style.padding=e.style.padding+"px",this.$window.style.boxSizing="border-box",this.$window.style.userSelect="none",this.$window.style.minWidth=this.minWidth+"px",this.$window.style.minHeight=this.minHeight+"px",e.initialWidth?this.$window.style.width=e.initialWidth+s+"px":this.$window.style.width=this.minWidth+s+"px",this.$window.style.height=this.minHeight+s+"px",this.$background.style.position="absolute",this.$background.style.left=0,this.$background.style.top=0,this.$background.style.right=0,this.$background.style.bottom=0,this.$background.style.zIndex=-1,this.$background.style.opacity=.9,this.$wrapper.style.minWidth=this.minWidth-e.style.padding*2+"px",this.$wrapper.style.minHeight=this.minHeight-e.style.padding*2+"px",this.$wrapper.style.width=this.minWidth+s-e.style.padding*2+"px",this.$wrapper.style.height=this.minHeight+s-e.style.padding*2+"px",this.$wrapper.style.position="absolute",this.$wrapper.style.border=`${e.style.borderWidth}px ${e.style.borderStyle}`,this.$wrapper.style.overflow="hidden",this.$window.oncontextmenu=l=>{l.preventDefault(),l.stopPropagation()};function o(){i.$window.remove(),i.eventListener.close.forEach(l=>{l()})}return this}D.prototype.addEventListener=function(n,t){this.eventListener[n].push(t)};D.prototype.getClickedResizer=function(n,t){let i=t>this.$window.offsetTop&&t<this.$window.offsetTop+this.cursorThreshold,e=n<this.$window.offsetLeft+this.$window.offsetWidth&&n>this.$window.offsetLeft+this.$window.offsetWidth-this.cursorThreshold,s=t<this.$window.offsetTop+this.$window.offsetHeight&&t>this.$window.offsetTop+this.$window.offsetHeight-this.cursorThreshold,o=n>this.$window.offsetLeft&&n<this.$window.offsetLeft+this.cursorThreshold;return s&&e?"se":s&&o?"sw":i&&e?"ne":i&&o?"nw":i?"n":e?"e":s?"s":o?"w":""};D.prototype.setContent=function(n){this.body.reset(n)};D.prototype.finalize=function(){this.$wrapper.style.width=this.$window.offsetWidth-this.padding*2+"px",this.$wrapper.style.height=this.$window.offsetHeight-this.padding*2+"px",this.body.$element.style.maxHeight=this.$wrapper.offsetHeight-this.header.$element.offsetHeight+"px"};var Ge={name:"dark",backgroundColor:"#222222",borderWidth:1,borderStyle:"solid",style:{body:{backgroundColor:"#222222",color:"#ffffff",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif"},button:{cursor:"pointer"}}},Ke={name:"light",backgroundColor:"#ffffff",borderWidth:1,borderStyle:"solid",style:{body:{backgroundColor:"#ffffff",color:"#222222",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif"},button:{cursor:"pointer"}}},J={dark:Ge,light:Ke};var ge=document.head,Ve=document.body;function ye(){let n=null;this.themeListeners=[];function t(i){let e=document.createElement("style");for(let[s,o]of Object.entries(i.style))if(s==="body")for(let[l,c]of Object.entries(o))Ve.style[l]=c;else if(s==="button"){let l="";for(let[c,d]of Object.entries(o))l+=`${je(c)}: ${d}; `;e.innerHTML+=`button { ${l} }`}return e}this.getTheme=()=>n,this.setTheme=function(i,e){if(!i)throw Error("Unknown newTheme",i);if(typeof i=="string"&&J[i]){this.setTheme(J[i]);return}n!==null&&ge.removeChild(n.$style);let s=t(i);n={...i,$style:s},ge.appendChild(s),this.notify(n),e&&e(n)},this.addListener=i=>{this.themeListeners.push(i)},this.notify=i=>{this.themeListeners.forEach(e=>e(i))}}function je(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var Q=new ye,H=()=>(Q||(Q=new ye),Q);var ee=C(),we=H(),Ze=document.body,X={mousemove:"mousemove",mouseup:"mouseup"};function be(){let n=this,t={};this.sendToTop=function(e){if(e){for(let[,s]of Object.entries(t)){let o=parseInt(s.$window.style.zIndex);o>1&&(s.$window.style.zIndex=o-1)}e.$window.style.zIndex=5}};function i(e,s={}){if(!e)throw Error("Unknown customWindow",e);let o=e.$window,l=e.$wrapper;o.style.position="absolute";let{resizeable:c,draggable:d,style:a={padding:16}}=s,r={x:0,y:0},h={x:0,y:0},p={w:0,h:0},$=!1,x=!1,A=!1,f="",S=u=>{$=!0,n.sendToTop(e),r.x=u.clientX,r.y=u.clientY,p.w=o.offsetWidth,p.h=o.offsetHeight,h.x=Math.abs(r.x-o.offsetLeft),h.y=Math.abs(r.y-o.offsetTop),f=e.getClickedResizer(u.clientX,u.clientY)},W=u=>{if(x||A)return;let L=u.clientY>o.offsetTop&&u.clientY<o.offsetTop+e.cursorThreshold,w=u.clientX<o.offsetLeft+o.offsetWidth&&u.clientX>o.offsetLeft+o.offsetWidth-e.cursorThreshold,M=u.clientY<o.offsetTop+o.offsetHeight&&u.clientY>o.offsetTop+o.offsetHeight-e.cursorThreshold,V=u.clientX>o.offsetLeft&&u.clientX<o.offsetLeft+e.cursorThreshold;if(L&&V||M&&w){o.style.cursor="nwse-resize";return}else if(L&&w||M&&V){o.style.cursor="nesw-resize";return}else if(w||V){o.style.cursor="col-resize";return}else if(L||M){o.style.cursor="row-resize";return}o.style.cursor="auto"},O=u=>{if($)if(e.isHeaderMousedown){if(!d)return;o.style.left=u.clientX-h.x+"px",o.style.top=u.clientY-h.y+"px"}else{if(!c)return;f.includes("e")?(o.style.width=p.w-(r.x-u.clientX)+"px",l.style.width=p.w-(r.x-u.clientX)-e.padding*2+"px"):f.includes("w")&&u.clientX-h.x<r.x+p.w-a.padding*2-e.cursorThreshold&&p.w+(r.x-u.clientX)-e.minWidth>0&&(o.style.left=u.clientX-h.x+"px",o.style.width=p.w+(r.x-u.clientX)+"px",l.style.width=p.w+(r.x-u.clientX)-e.padding*2+"px"),f.includes("s")?(o.style.height=p.h-(r.y-u.clientY)+"px",l.style.height=p.h-(r.y-u.clientY)-e.padding*2+"px"):f.includes("n")&&u.clientY-h.y<r.y+p.h-a.padding*2-e.cursorThreshold&&p.h+(r.y-u.clientY)-e.minHeight>0&&(o.style.top=u.clientY-h.y+"px",o.style.height=p.h+(r.y-u.clientY)+"px",l.style.height=p.h+(r.y-u.clientY)-e.padding*2+"px"),e.body.$element.style.maxHeight=l.offsetHeight-e.header.$element.offsetHeight+"px"}};o.onmousedown=S,c&&(o.onmousemove=W),ee.addListener(e.id,X.mousemove,O),ee.addListener(e.id,X.mouseup,()=>{$=!1,x=!1,A=!1,e.isHeaderMousedown=!1})}this.createWindow=function(e){let s={draggable:!1,resizeable:!1,theme:we.getTheme(),...e},o=new D(s,we);if(!t[o.name])return t[o.name]=o,(s.draggable||s.resizeable)&&i(o,s),o.addEventListener("close",function(){n.destroyWindow(o.name)}),Ze.appendChild(o.$window),o.finalize(),o},this.destroyWindow=function(e){let s=t[e];for(let o=0;o<Object.keys(X).length;o++){let l=Object.keys(X)[o];ee.removeListener(`customWindow_${s.id}`,l)}delete t[e]},this.closeAllWindow=function(){for(let[,e]of Object.entries(t))e.$window.remove(),this.destroyWindow(e.name)},this.isWindowOpened=function(e){return t[e]!==void 0},this.setWindowContent=function(e,s){let o=t[e];o&&o.setContent(s)},this.notify=e=>{for(let[,s]of Object.entries(t))s.setTheme(e)}}var xe=C(),qe=H(),Je=document.body;function Ee(){this.$contextMenu=void 0,this.$contextMenus=[],this.getContextMenu=()=>{},this.showContextMenu=function(n,t,i){let e=document.createElement("div");e.style.border="1px solid",e.style.padding="8px",e.style.position="absolute",e.style.zIndex=9,e.style.left=n+"px",e.style.top=t+"px";try{e.style.backgroundColor=qe.getTheme().style.body.backgroundColor}catch(s){console.error(s)}e.onclick=()=>this.destroyContextMenu(),e.oncontextmenu=s=>{s.preventDefault(),s.stopPropagation()},i?i.forEach(s=>{s.style.display="block",e.appendChild(s)}):this.$contextMenus.forEach(s=>{e.appendChild(s)}),this.$contextMenu=e,Je.appendChild(this.$contextMenu)},this.moveContextMenu=function(n,t){this.$contextMenu.style.left=n+"px",this.$contextMenu.style.top=t+"px"},this.destroyContextMenu=function(){this.$contextMenu&&(this.$contextMenu.remove(),this.$contextMenu=void 0)},this.addToContextMenu=function(n){n.style.display="block",this.$contextMenus.push(n)},this.init=function(){xe.addListener("UI","contextmenu",n=>{if(n.preventDefault(),this.getContextMenu(n.target),this.$contextMenu){this.moveContextMenu(n.clientX,n.clientY);return}this.showContextMenu(n.clientX,n.clientY)}),xe.addListener("UI","mousedown",n=>{!this.$contextMenu||n.target===this.$contextMenu||this.$contextMenu.contains(n.target)||this.destroyContextMenu()})}}var $e=new me,z=H(),T=new be,ne=new Ee;function E(){return this.init=()=>{this.setTheme("dark"),ne.init()},this}E.prototype.getTheme=z.getTheme.bind(z);E.prototype.createIcon=$e.createIcon.bind($e);E.prototype.sendToTop=T.sendToTop.bind(T);E.prototype.createWindow=T.createWindow.bind(T);E.prototype.addThemeListener=z.addListener.bind(z);E.prototype.closeAllWindow=T.closeAllWindow.bind(T);E.prototype.setWindowContent=T.setWindowContent.bind(T);E.prototype.showContextMenu=ne.showContextMenu.bind(ne);E.prototype.setTheme=n=>z.setTheme(n,t=>{T.notify(t)});var te=new E,m=()=>(te||(te=new E),te);var Te=m(),Qe=C(),Me=U(),R="Dock";function Ce(){let n=this;this.name=R,Me.addEventListener("install",()=>{this.refresh()}),this.ui=new de(Te.getTheme()),Te.addThemeListener(t=>n.ui.setTheme(t)),Qe.addListener(R,"mousedown",t=>{t.target!==n.ui.getMenuElement()&&t.target!==n.ui.getMenuTrigger()&&!(t.target instanceof HTMLButtonElement)&&n.ui.closeMenu()}),this.refresh=()=>{n.ui.clear(),Me.getAllExcepts([R,"Desktop"]).forEach(function(t){let i=document.createElement("button");i.innerHTML=t.name,i.onclick=()=>t.start(),n.ui.addToMenu(i)})},this.start=()=>{this.ui.render(),this.refresh()},this.stop=()=>{this.ui.destroy()}}var ie;function et(){let n=0,t=new Map;this.add=function(i,e){if(!i||!e)throw Error("Invalid arguments.");if(e.size&&(n+=e.size),!t.has(i))t.set(i,e);else{let s=t.get(i);s.data&&(s.size&&e.size&&(s.size+=e.size),s.data.set(e.id,e))}},this.get=function(i){if(!i)throw Error("Invalid path.",i);let e=new Map;t.forEach((o,l)=>{i==="/"?(l.match(/\//g)||[]).length===2&&e.set(l,o):l!==i&&l.startsWith(i)&&(l.replace(i,"").match(/\//g)||[]).length===1&&e.set(l,o)});let s=t.get(i);return s&&s.data&&s.data.forEach(o=>e.set(o.id,o)),e},this.deletePathData=(i,e)=>t.get(i).data.delete(e),this.getSize=function(){return n},this.set=function(i,e){t.set(i,e)},this.bulkModify=function(i,e){t.forEach((s,o)=>{o.startsWith(i)&&(s.path=e+o.substring(1),t.set(s.path,s),t.delete(o))})},this.deleteByPath=function(i){t.delete(i)},this.delete=function(i){if(i.type==="directory")t.delete(i.path);else{let e=t.get(i.path);e.size&&i.size&&(e.size-=i.size),e.data.delete(i.id)}},this.log=()=>{console.info(t)}}var Le=()=>(ie||(ie=new et),ie);var oe,I=Le();function g(){let e=0,s=o();this.listener=new Map,this.directoryListener={};function o(){return Math.random().toString(36).slice(2,5)}function l(){return e>9007199254740991+-3&&(e=0,s=o()),++e+s}function c(a={}){let{type:r,name:h,path:p}=a,$=r.slice(0,1)+l();return{id:$,path:r==="directory"?p+$+"/":p,type:r,name:h||r,size:1}}this.createFile=function(a={}){let r=c({type:"file",...a});return this.listener.forEach((h,p)=>{h({event:g.CREATE_FILE,data:r})}),r},this.createDirectory=function(a={}){let r={...c({type:"directory",...a}),data:new Map};return this.listener.forEach((h,p)=>{h({event:g.CREATE_DIRECTORY,data:r})}),r},this.createRootDirectory=function(){return{...c({type:"directory"}),path:"/",name:"root",data:new Map,isSystemFile:!0}},this.createSystemDirectory=function(a){return{...c({type:"directory"}),path:"/"+a+"/",name:a,data:new Map,isSystemFile:!0}},this.getParentPath=a=>{let r=a.split("/");return r.pop(),r.length>1&&r.pop(),r.join("/")+"/"},this.isSystemFile=a=>a.isSystemFile,this.addListener=(a,r)=>{this.listener.set(a,r)},this.listenToDirectory=(a,r)=>{this.directoryListener[a.id]?this.directoryListener[a.id].push(r):this.directoryListener[a.id]=[]},this.rename=function(a,r){return a.name=r,a},this.read=function(a){console.info(a)},this.addToStorage=function(a={}){I.add(a.path,a),this.listener.forEach((r,h)=>{r({event:g.ADD_TO_STORAGE,data:a})})},this.move=function(a,r){r.type==="directory"&&(a.type==="file"?(r.data.set(a.id,a),I.deletePathData(a.path,a.id)):I.bulkModify(a.path,r.path),this.listener.forEach((h,p)=>{h({event:g.MOVE,data:{toBeMoved:a,target:r}})}))},this.set=function(a,r){I.set(a,r)},this.get=function(a){return I.get(a)},this.delete=function(a={}){this.listener.forEach((r,h)=>{r({event:g.DELETE,data:a})}),I.delete(a)};let d=this.createRootDirectory();I.add("/",d)}g.ADD_TO_STORAGE="addToStorage";g.CREATE_FILE="createFile";g.CREATE_DIRECTORY="createDirectory";g.DELETE="delete";g.MOVE="move";var N=()=>(oe||(oe=new g),oe),Wt=g.MOVE,ke=g.DELETE,Ie=g.CREATE_FILE,Se=g.CREATE_DIRECTORY,Ot=g.ADD_TO_STORAGE;var v=N(),F=m(),se="Desktop";function De(n){let t=this;this.name=se,this.path="/desktop/",this.iconDomMap={};let i=document.createElement("div");i.id="$desktop",i.style.position="fixed",i.style.left=0,i.style.top=0,i.style.width="100vw",i.style.height="100vh",i.oncontextmenu=o=>{o.preventDefault();let l=document.createElement("button");l.innerHTML="Create file",l.onclick=()=>{let a=v.createFile({name:null,path:this.path});v.addToStorage(a)};let c=document.createElement("button");c.innerHTML="Close All Window",c.onclick=function(){F.closeAllWindow()};let d=[c,l];F.showContextMenu(o.clientX,o.clientY,d)};let e=v.createSystemDirectory("desktop");v.addToStorage(e),v.listenToDirectory(e,o=>{i.innerHTML="",o.forEach(l=>{s(l)})});function s(o){let l=document.createElement("div");l.innerHTML=JSON.stringify(o),l.style.background="#222",l.style.maxWidth="100px",l.style.maxHeight="100px",l.style.overflow="auto";let c=F.createIcon(o.id,l,o.type);o.type==="file"&&(c.ondblclick=()=>{n.run("File Reader",o)},c.oncontextmenu=d=>{d.preventDefault(),d.stopPropagation(),F.destroyContextMenu();let a=[],r=document.createElement("button");r.innerHTML="Open",r.onclick=()=>{n.run("File Reader",o)},a.push(r),F.showContextMenu(d.clientX,d.clientY,a)}),t.iconDomMap[o.id]=c,i.appendChild(c)}v.addListener("desktop.app",o=>{if(o&&!(!o.event||!o.data)){if(o.event===Ie){if(o.data.path!==this.path)return;s(o.data)}else if(o.event===Se){if(!o.data.path||o.data.path.startsWith(this.path)===!1||(o.data.path.match(/\//g)||[]).length!==3)return;s(o.data)}else if(o.event===ke){if(!o.data.path)return;(o.data.path===this.path||o.data.path.startsWith(this.path)&&(o.data.path.match(/\//g)||[]).length===3)&&this.iconDomMap[o.data.id].remove()}}}),this.start=()=>{document.body.appendChild(i)}}var P=m();function He(){this.name="Settings",this.getContent=function(){let n=document.createElement("div"),t=document.createElement("button");t.onclick=function(){P.setTheme("dark")},t.innerHTML="Change to Dark Theme",n.appendChild(t);let i=document.createElement("button");return i.onclick=function(){P.setTheme("light")},i.innerHTML="Change to Light Theme",n.appendChild(i),n},this.start=()=>{let n=P.createWindow({name:this.name,resizeable:!0,draggable:!0});P.sendToTop(n);let t=this.getContent();P.setWindowContent(this.name,t)}}var b=N(),re=m();function ve(n){let t=this;this.name="File Manager",this.currentPath="/",this.getHead=()=>{let s=document.createElement("div");s.style.marginBottom="8px";let o=document.createElement("button");o.innerHTML="create file",o.onclick=()=>{let a=b.createFile({name:null,path:this.currentPath});b.addToStorage(a),this.reload()},s.appendChild(o);let l=document.createElement("button");l.innerHTML="create directory",l.onclick=()=>{let a=b.createDirectory({name:null,path:this.currentPath});b.addToStorage(a),this.reload()},s.appendChild(l);let c=document.createElement("button");c.innerHTML="back",c.onclick=()=>{this.currentPath=b.getParentPath(this.currentPath),this.reload()};let d=document.createElement("p");return d.innerHTML=this.currentPath,s.appendChild(c),s.appendChild(d),s},this.getBody=()=>{let s=document.createElement("div"),o=this.generateTable();return s.appendChild(o),s},this.getRoot=()=>{let s=document.createElement("div"),o=this.getHead(),l=this.getBody();return s.appendChild(o),s.appendChild(l),s},this.reload=()=>{let s=this.getRoot();re.setWindowContent(this.name,s)},this.openDirectory=s=>{this.currentPath=s.path,this.reload()};function i(){let s=document.createElement("td");return s.style.border="1px solid",s.style.padding="4px",s}function e(s){let o=document.createElement("th");return o.style.border="1px solid",o.style.padding="4px",o.innerHTML=s,o}this.generateTable=()=>{let s=b.get(this.currentPath),o=document.createElement("table");o.style.borderCollapse="collapse",o.style.width="100%";let l=document.createElement("thead"),c=document.createElement("tr");c.appendChild(e("ID")),c.appendChild(e("Name")),c.appendChild(e("Type")),c.appendChild(e("Size")),l.appendChild(c),o.appendChild(l);let d=document.createElement("tbody");o.appendChild(d);let a;return s.forEach(r=>{let h=document.createElement("tr");r.isSystemFile||(h.draggable=!0,h.ondragstart=()=>a=r),h.ondragenter=f=>{h.style.backgroundColor="yellow"},h.ondragleave=f=>{h.style.backgroundColor="initial"},h.ondragover=f=>f.preventDefault(),h.ondrop=()=>{h.style.backgroundColor="initial",a.path.includes(r.path)||(b.move(a,r),this.reload())},h.onmousedown=function(f){f.button===2?(h.style.backgroundColor="#666",setTimeout(()=>{h.style.backgroundColor="initial"},200)):h.style.backgroundColor="#666"},h.onmouseup=function(f){h.style.backgroundColor="initial"};let p=i(),$=i(),x=i(),A=i();h.oncontextmenu=function(f){f.preventDefault();let S=[],W=document.createElement("button");if(W.innerHTML="Open",W.onclick=()=>{r.type==="file"?n.run("File Reader",r):r.type==="directory"&&t.openDirectory(r)},S.push(W),!b.isSystemFile(r)){let O=document.createElement("button");O.innerHTML="Rename";let u=w=>{let M=b.rename(r,w.target.innerHTML);x.contentEditable=!1,b.set(r.id,M)};O.onclick=()=>{x.contentEditable=!0,x.focus(),setTimeout(()=>{let w=document.createRange();w.selectNodeContents(x);var M=window.getSelection();M.removeAllRanges(),M.addRange(w)},50),x.onkeydown=w=>{w.key==="Enter"&&w.target.blur()},x.onblur=w=>u(w)},S.push(O);let L=document.createElement("button");L.innerHTML="Delete",L.onclick=()=>{b.delete(r),t.reload()},S.push(L)}re.showContextMenu(f.clientX,f.clientY,S)},h.ondblclick=()=>{r.type==="file"?n.run("File Reader",r):r.type==="directory"&&t.openDirectory(r)},p.innerHTML=r.id,$.innerHTML=r.type,x.innerHTML=r.isSystemFile?"."+r.name:r.name,A.innerHTML=r.size,h.appendChild(p),h.appendChild(x),h.appendChild($),h.appendChild(A),d.appendChild(h)}),o},b.addListener("file-manager.app",s=>{s&&(!s.event||!s.data||this.reload())}),this.start=()=>{re.createWindow({name:this.name,resizeable:!0,draggable:!0,initialWidth:300}),this.reload()}}var B=m();function Ae(){this.name="File Reader",this.file=void 0,this.getContent=function(){if(this.file){let n=document.createElement("div");return n.style.wordBreak="break-all",n.style.userSelect="text",n.oncontextmenu=t=>t.stopPropagation(),n.innerHTML=JSON.stringify(this.file),n}else{let n=document.createElement("button");return n.onclick=function(){B.createWindow({name:"file prompt",resizeable:!0,draggable:!0})},n.innerHTML="Open File",n}},this.start=n=>{n&&(this.file=n);let t=B.createWindow({name:this.name,resizeable:!0,draggable:!0});B.sendToTop(t);let i=this.getContent();B.setWindowContent(this.name,i)}}var ae=m();function We(){this.name="Window Creator",this.start=()=>{ae.createWindow({name:this.name,resizeable:!0,draggable:!0});let n=document.createElement("button");n.innerHTML="create window",n.onclick=()=>{ae.createWindow({draggable:!0,resizeable:!0})},ae.setWindowContent(this.name,n)}}function tt(n){let t=n.split(""),i=[],e="",s=!0;return t.forEach(o=>{s&&o===" "?(i.push(e),e=""):s&&o==='"'?s=!1:s===!1&&o==='"'?s=!0:e+=o}),i.push(e),e="",i}var Oe=tt;function ze(){return this.debug=!1,this.functionMap={},this.register=function(n,t){this.functionMap[n]=t},this.execute=function(...n){n.length===2?this.executeByKey(n[0],n[1]):this.executeLineCommand(n[0])},this.executeByKey=function(n,t){if(this.debug&&console.log(`[${performance.now().toFixed(2)}] executing: ${n}`),!this.functionMap[n])throw Error("Unknown function: "+n);return this.functionMap[n](t)},this.executeLineCommand=function(n){let t=Oe(n),i=t[0];if(!this.functionMap[i])throw Error("Invalid line command: "+i);this.executeByKey(i,t[1])},this.executeLater=function(n,t){let i=this;setTimeout(()=>{i.execute(n)},t)},this}var le=new ze,Re=()=>(le||(le=new ze),le);var ce=m(),Fe=Re();function Pe(){this.name="Terminal";let n=[],t=document.createElement("div");Fe.register("echo",e=>{n.push(e),i()});function i(){t.innerHTML="";for(let e=n.length-1;e>=0;e--){let s=n[e];t.innerHTML+=`${s}<br>`}}this.getContent=function(){let e=document.createElement("div"),s=document.createElement("input");return s.placeholder='echo "hello world"',s.addEventListener("keydown",o=>{o.key==="Enter"&&(console.log(s.value),Fe.execute(s.value),s.value="")}),e.append(s),e.append(t),e},this.start=()=>{let e=ce.createWindow({name:this.name,resizeable:!0,draggable:!0});ce.sendToTop(e);let s=this.getContent();ce.setWindowContent(this.name,s)}}var nt=m(),G=U();function K(){this.boot=()=>{nt.init(),this.install(new Ce),this.install(new He),this.install(new Ae),this.install(new De(Y)),this.install(new We),this.install(new ve(Y)),this.install(new Pe),this.get(R).start(),this.get(se).start()},this.run=function(n,t){this.run(n,t)}}K.prototype.get=G.get.bind(G);K.prototype.install=G.install.bind(G);var Y=new K,Ye=()=>(Y||(Y=new K),Y);var it=Ye();it.boot();})();
